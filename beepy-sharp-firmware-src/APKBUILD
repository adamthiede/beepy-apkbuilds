# Contributor: Adam Thiede <me@adamthiede.com>
# Maintainer: Adam Thiede <me@adamthiede.com>
pkgname=beepy-sharp-firmware-src
_modname=sharp-drm
_modver=1.5
pkgver=1
pkgrel=0
pkgdesc="beepy sharp memory display firmware"
url="https://github.com/ardangelo/sharp-drm-driver"
arch="aarch64"
license="GPL-2.0-or-later"
depends="akms dtc linux-rpi-dev"
makedepends="linux-rpi-dev dtc"
checkdepends=""
install=""
subpackages=""
source="$pkgname-$pkgver.tar.gz::https://github.com/adamthiede/sharp-drm-driver/archive/refs/tags/$pkgver.tar.gz"
builddir="$srcdir/sharp-drm-driver-$pkgver"
options="!check" #no tests

prepare() {
	default_prepare

	cat >AKMBUILD <<-EOF
	modname=$_modname
	modver=$_modver
	built_modules=$_modname.ko

	build() {
		make
	}
	EOF
}

build() {
	make
}

package() {
	install -Dm755 "$builddir"/monoset "$pkgdir"/usr/bin/monoset
	install -Dm644 "$builddir"/sharp-drm.dtbo "$pkgdir"/boot/overlays/sharp-drm.dtbo

	local destdir="$pkgdir/usr/src/$_modname-$pkgver"
	install -Dm644 -t "$destdir" AKMBUILD Makefile
	cp -r src sharp-drm.dts "$destdir"
}

sha512sums="
d784f3aa2e99b45a0154086ec110cfc58cfaaa4247bf4d12cfa7b168519f80be394a776247582bd81d04dfab49292be7810d8ca1ecc9fa79269f7b4fda2cc95e  beepy-sharp-firmware-src-1.tar.gz
"
